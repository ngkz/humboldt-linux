= Linux from Scratch
:source-highlighter: pygments
Kazutoshi Noguchi

== Installing Basic System Software
=== Gzip-1.9
Extract source code:
[source,bash]
----
cd /var/tmp
tar -xf /sources/gzip-1.9.tar.xz
cd gzip-1.9
----

Make some fixes required by glibc-2.28:

[source,bash]
----
sed -i 's/IO_ftrylockfile/IO_EOF_SEEN/' lib/*.c
echo "#define _IO_IN_BACKUP 0x100" >> lib/stdio-impl.h
----


Prepare Gzip for compilation:

[source,bash]
----
./configure --prefix=/usr
----

Compile the package:

[source,bash]
----
make
----

To test the results, issue:

[source,bash]
----
make check
----

Two tests are known to fail in the LFS environment: help-version and zmore.

Package gzip:

[source,bash]
----
make DESTDIR=/usr/pkg/gzip-1.9 install
----

Purging unneeded files:
[source,bash]
----
rm -fv /usr/pkg/gzip-1.9/usr/share/info/dir
----

Strip the debug information:
[source,bash]
----
strip-pkg /usr/pkg/gzip-1.9
----

Compress man and info pages:
[source,bash]
----
compressdoc /usr/pkg/gzip-1.9
----

Install the package:
[source,bash]
----
cp -rsv /usr/pkg/gzip-1.9/* /
----

////
Purging unneeded files:
[source,bash]
----
存在する場合だけ
rm -fv /usr/pkg/PKG/usr/share/info/dir
rm -fv /usr/pkg/PKG/etc/ld.so.cache
find /usr/pkg/PKG/usr/{lib,lib32} -name "*.la" -delete -printf "removed '%p'\n"
find /usr/pkg/PKG \( -name ".packlist" -o -name "*.pod" \) -delete -printf "removed '%p'\n"
----

Strip the debug information:
[source,bash]
----
strip-pkg /usr/pkg/PKG
----

Compress man and info pages:
[source,bash]
----
compressdoc /usr/pkg/PKG
----

Install the package:
[source,bash]
----
cp -rsv /usr/pkg/PKG/* /
----

ライブラリがインストールされたら (glibc以降)
Rebuild dynamic linker cache:
[source,bash]
----
ldconfig
----
////
